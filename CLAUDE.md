# Claude Code プロジェクトガイドライン

## プロジェクト概要

ccusage CLIツールを使用してClaude Codeの使用コストを表示するmacOSメニューバーアプリケーションです。

## 主な機能

- メニューバーに今日のコストを表示（例：「$54.51」）
- 設定可能な間隔での自動更新機能
- 月次使用量レポート表示
- 設定画面
- ログイン時起動サポート
- ccusageパスの動的検出

## 開発ルール（DEVELOPMENT_RULES.mdより）

### タスク完了要件

- 各TODOタスクは実装後にユーザーテストとレビューが必須
- ユーザーレビューに合格して初めて「完了」となる
- レビュー不合格の場合は、問題を修正してから再レビュー

### コミットワークフロー

1. タスク実装
2. ユーザーテストを依頼
3. ユーザーがレビュー
4. 承認された場合 → gitコミット → 次のタスクへ
5. 承認されない場合 → 修正 → ステップ2に戻る

### テスト依頼時の記載事項

動作確認を依頼する際は以下を明記：

- 実装内容の概要
- テストしてほしい具体的なポイント
- 期待される動作

## 重要なコマンド

### ビルドコマンド

```bash
# デバッグビルド
swift build

# リリースビルド
./build-release.sh

# アプリアイコン生成
./generate-app-icon.sh
```

### リントとタイプチェック

Swift Package Managerプロジェクトのため、特定のlint/typecheckコマンドは設定されていません。Swiftコンパイル自体が型チェックを提供します。

## 技術詳細

### アーキテクチャ

- **Swift Package Manager**プロジェクト（従来のXcodeプロジェクトではない）
- macOS 13+向け**MenuBarExtra** API
- Processを介した**ccusage**統合
- 設定永続化のための**UserDefaults**
- ログイン時起動のための**SMAppService**

### 主要ファイル

- `CCUsageMenuBarApp.swift` - メインアプリエントリーポイント
- `CCUsageService.swift` - ccusageコマンド実行
- `MenuBarViewModel.swift` - ビジネスロジック
- `SettingsView.swift` - 設定UI
- `build-release.sh` - リリースビルドスクリプト

### パス処理

アプリはccusageのインストール場所を動的に検出：

- `$HOME/.nvm/versions/node/*/bin/ccusage`
- ユーザー指定のカスタムパス
- 適切な環境でのbash実行へのフォールバック

### 解決済みの既知の問題

- メニューバーアイコンが消える → systemImageなしでtitleを使用して修正
- リリースビルドで「ccusageが見つからない」→ 動的パス検出で修正
- 設定ウィンドウが操作時に閉じる → 別のNSWindowで修正

## ベストプラクティス

1. デバッグビルドとリリースビルドの両方で必ずテスト
2. 既存のコード規約に従う
3. タスクを完了とマークする前にユーザーレビューを依頼
4. アトミックでテスト可能な作業単位を作成
5. エラーは即座に報告
6. 不明な点は実装前に確認